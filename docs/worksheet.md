# GPU AG - Worksheet (RND-790)

## Цель

Улучшение функции награды GPU оптимизатора.

---

## [2025-12-22 03:50] Старт задачи RND-790

### Baseline (из ME-26)
- Extended pseudoTypeLog работает
- MSE_POWER=1.0, DIP_ANGLE_RANGE=5°
- RMSE в конце скважины: ~10м
- Интерпретация "колбасит" — осцилляции

### План экспериментов

1. **Штрафы за углы**
   - Добавить prev_segment_angle в angle_sum_penalty
   - Дисперсия GR вокруг угла как модулятор

2. **Комбинации параметров**
   - MSE_POWER: 0.5, 1.0, 2.0
   - DIP_ANGLE_RANGE: 2°, 5°, 10°
   - ANGLE_SUM_POWER

3. **Детектор перегибов (C++)**
   - Изучить и портировать

4. **Гриды**
   - Добавить grid penalty

5. **Self-correlation**
   - Обновление pseudo в процессе

---

## Обсуждение: Дисперсия GR для модуляции штрафа

### Идея
- Низкая дисперсия GR → мало информации → увеличить штраф за поворот
- Высокая дисперсия → много информации → уменьшить штраф

### Где мерить дисперсию
**Вокруг угла** (не в одном сегменте):
```
[===сегмент A===][===сегмент B===]
                 ^
                 угол
       |------окно------|
       пол A     +     пол B
```

### Формула (предварительная)
```python
variance = np.var(well_gr[mid_A : mid_B])
weight = 1.0 / (1.0 + variance * k)
angle_penalty_i = |angle_diff_i| * weight
```

### Важно
- Используем **родную GR скважины**, не проецированную
- Дисперсия — константа, считаем **один раз** перед оптимизацией
- Не пересчитываем для каждого кандидата

---

## Заметки

(записывать результаты экспериментов здесь)
